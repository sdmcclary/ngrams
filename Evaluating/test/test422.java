public class UsemapChecker extends Checker { private final Map < String , Locator > usemapLocationsByName = new LinkedHashMap < String , Locator > ( ) ; private final Set < String > mapNames = new HashSet < String > ( ) ; private Locator locator = null ; public UsemapChecker ( ) { } @ Override public void startElement ( String uri , String localName , String qName , Attributes atts ) throws SAXException { if ( "http://www.w3.org/1999/xhtml" == uri ) { if ( "map" == localName ) { String name = atts . getValue ( "" , "name" ) ; if ( name != null && ! "" . equals ( name ) ) { mapNames . add ( name ) ; } } else if ( "img" == localName || "object" == localName ) { String usemap = atts . getValue ( "" , "usemap" ) ; if ( usemap != null ) { int hashIndex = usemap . indexOf ( '#' ) ; if ( hashIndex > - 1 ) { if ( hashIndex < usemap . length ( ) - 1 ) { String ref = usemap . substring ( hashIndex + 1 ) ; usemapLocationsByName . put ( ref , new LocatorImpl ( locator ) ) ; } } } } } } @ Override public void endDocument ( ) throws SAXException { for ( Map . Entry < String , Locator > entry : usemapLocationsByName . entrySet ( ) ) { if ( ! mapNames . contains ( entry . getKey ( ) ) ) { err ( "The hash-name reference in attribute “usemap” referred to “" + entry . getKey ( ) + "”, but there is no “map” element with a “name” attribute with that value." , entry . getValue ( ) ) ; } } } @ Override public void startDocument ( ) throws SAXException { usemapLocationsByName . clear ( ) ; mapNames . clear ( ) ; } @ Override public void setDocumentLocator ( Locator locator ) { this . locator = locator ; } @ Override public void reset ( ) { usemapLocationsByName . clear ( ) ; mapNames . clear ( ) ; } } 