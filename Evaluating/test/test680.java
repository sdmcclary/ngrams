<<<<<<< HEAD
public class SchemaElement { private static final Class < ? > [ ] enterSignature = new Class [ ] { String . class , String . class , String . class , Attributes . class } ; private static final Class < ? > [ ] exitSignature = new Class [ ] { String . class , String . class , String . class } ; private String _name ; private Schema _owningSchema ; private Map < String , SchemaElement > _transitions ; private Map < String , Integer > _attributes ; private List < String > _requiredAttributes ; private String _instanceAttributes ; private Method _onEnter ; private Method _onExit ; private boolean _hasText ; public SchemaElement ( Schema owningSchema , String name ) { if ( owningSchema == null ) { throw new IllegalArgumentException ( Messages . SchemaElement_Undefined_Owning_Schema ) ; } if ( name == null || name . length ( ) == 0 ) { throw new IllegalArgumentException ( Messages . SchemaElement_Undefined_Name ) ; } this . _owningSchema = owningSchema ; this . _name = name ; this . _transitions = new HashMap < String , SchemaElement > ( ) ; this . _attributes = new HashMap < String , Integer > ( ) ; this . _requiredAttributes = new ArrayList < String > ( ) ; } public String getName ( ) { return this . _name ; } public Method getOnEnterMethod ( ) { return this . _onEnter ; } public void setHasText ( boolean value ) { this . _hasText = value ; } public void setOnEnter ( String onEnterMethod ) throws SecurityException , NoSuchMethodException { Class < ? > handlerClass = this . _owningSchema . getHandlerClass ( ) ; if ( handlerClass != null ) { this . _onEnter = handlerClass . getMethod ( onEnterMethod , enterSignature ) ; } else { this . _onEnter = null ; } } public Method getOnExitMethod ( ) { return this . _onExit ; } public void setOnExit ( String onExitMethod ) throws SecurityException , NoSuchMethodException { Class < ? > handlerClass = this . _owningSchema . getHandlerClass ( ) ; if ( handlerClass != null ) { this . _onExit = handlerClass . getMethod ( onExitMethod , exitSignature ) ; } else { this . _onExit = null ; } } public SchemaElement [ ] getTransitionElements ( ) { Collection < SchemaElement > values = this . _transitions . values ( ) ; return values . toArray ( new SchemaElement [ values . size ( ) ] ) ; } public boolean hasAttribute ( String name ) { return ( this . _attributes . containsKey ( name ) ) ; } public boolean hasOnEnterMethod ( ) { return ( this . _onEnter != null ) ; } public boolean hasOnExitMethod ( ) { return ( this . _onExit != null ) ; } public boolean hasText ( ) { return this . _hasText ; } public boolean hasTransitions ( ) { return ( this . _transitions . size ( ) > 0 ) ; } public boolean isDeprecatedAttribute ( String name ) { boolean result = false ; if ( this . isValidAttribute ( name ) ) { int flags = this . _attributes . get ( name ) . intValue ( ) ; result = ( ( flags & AttributeUsage . DEPRECATED ) == AttributeUsage . DEPRECATED ) ; } return result ; } public boolean isOptionalAttribute ( String name ) { boolean result = false ; if ( this . isValidAttribute ( name ) ) { int flags = this . _attributes . get ( name ) . intValue ( ) ; result = ( ( flags & AttributeUsage . USAGE_MASK ) == AttributeUsage . OPTIONAL ) ; } return result ; } public boolean isRequiredAttribute ( String name ) { boolean result = false ; if ( this . isValidAttribute ( name ) ) { int flags = this . _attributes . get ( name ) . intValue ( ) ; result = ( ( flags & AttributeUsage . USAGE_MASK ) == AttributeUsage . REQUIRED ) ; } return result ; } public boolean isValidAttribute ( String name ) { return ( this . _attributes . containsKey ( name ) ) ; } public boolean isValidTransition ( String name ) { return this . _transitions . containsKey ( name ) ; } public void addAttribute ( String name , String usage ) { if ( name == null || name . length ( ) == 0 ) { throw new IllegalArgumentException ( Messages . SchemaElement_Undefined_Name ) ; } if ( this . hasAttribute ( name ) ) { String msg = MessageFormat . format ( Messages . SchemaElement_Attribute_already_defined , name , this . _name ) ; throw new IllegalArgumentException ( msg ) ; } int usageValue ; if ( usage != null ) { if ( usage . equals ( "required" ) ) { usageValue = AttributeUsage . REQUIRED ; } else if ( usage . equals ( "optional" ) ) { usageValue = AttributeUsage . OPTIONAL ; } else { String msg = MessageFormat . format ( Messages . SchemaElement_Not_valid_usage_attribute , usage ) ; throw new IllegalArgumentException ( msg ) ; } } else { usageValue = AttributeUsage . REQUIRED ; } this . _attributes . put ( name , new Integer ( usageValue ) ) ; if ( ( usageValue & AttributeUsage . USAGE_MASK ) == AttributeUsage . REQUIRED ) { this . _requiredAttributes . add ( name ) ; } } public void addTransition ( SchemaElement node ) { if ( node == null ) { throw new IllegalArgumentException ( Messages . SchemaElement_Undefined_Node ) ; } String nodeName = node . getName ( ) ; if ( this . isValidTransition ( nodeName ) ) { String msg = "A node name '" + nodeName + "' has already been added to " + this . _name ; throw new IllegalArgumentException ( msg ) ; } this . _transitions . put ( nodeName , node ) ; } public SchemaElement moveTo ( String name ) { return this . _transitions . get ( name ) ; } public void validateAttributes ( Attributes attributes ) throws SAXException { if ( attributes . getLength ( ) > 0 ) { this . _instanceAttributes = "" ; for ( int i = 0 ; i < attributes . getLength ( ) ; i ++ ) { String key = attributes . getLocalName ( i ) ; String value = attributes . getValue ( i ) ; this . _instanceAttributes += " " + key + "=\"" + value + "\"" ; } } for ( int i = 0 ; i < this . _requiredAttributes . size ( ) ; i ++ ) { String name = this . _requiredAttributes . get ( i ) ; String value = attributes . getValue ( name ) ; if ( value == null ) { SourceWriter writer = new SourceWriter ( ) ; writer . print ( "<" ) . print ( this . _name ) . print ( "> requires a '" ) . print ( name ) . println ( "' attribute" ) ; this . _owningSchema . buildErrorMessage ( writer , this . _name , attributes ) ; throw new SAXException ( writer . toString ( ) ) ; } } for ( int i = 0 ; i < attributes . getLength ( ) ; i ++ ) { String name = attributes . getLocalName ( i ) ; if ( this . _attributes . containsKey ( name ) == false ) { SourceWriter writer = new SourceWriter ( ) ; writer . println ( MessageFormat . format ( Messages . SchemaElement_Invalid_attribute_on_tag , name , this . _name ) ) ; this . _owningSchema . buildErrorMessage ( writer , this . _name , attributes ) ; throw new SAXException ( writer . toString ( ) ) ; } } } public String toString ( ) { String result = "<" + this . _name ; if ( this . _instanceAttributes != null ) { result += this . _instanceAttributes ; } if ( this . hasTransitions ( ) ) { result += ">" ; } else { result += "/>" ; } return result ; } } 
=======
public class SoapObject implements KvmSerializable { protected String namespace ; protected String name ; protected Vector properties = new Vector ( ) ; protected Vector attributes = new Vector ( ) ; public SoapObject ( String namespace , String name ) { this . namespace = namespace ; this . name = name ; } public boolean equals ( Object obj ) { if ( ! ( obj instanceof SoapObject ) ) return false ; SoapObject otherSoapObject = ( SoapObject ) obj ; int numProperties = properties . size ( ) ; if ( numProperties != otherSoapObject . properties . size ( ) ) return false ; int numAttributes = attributes . size ( ) ; if ( numAttributes != otherSoapObject . attributes . size ( ) ) return false ; try { for ( int propIndex = 0 ; propIndex < numProperties ; propIndex ++ ) { PropertyInfo thisProp = ( PropertyInfo ) this . properties . elementAt ( propIndex ) ; Object thisPropValue = thisProp . getValue ( ) ; Object otherPropValue = otherSoapObject . getProperty ( thisProp . getName ( ) ) ; if ( ! thisPropValue . equals ( otherPropValue ) ) { return false ; } } for ( int attribIndex = 0 ; attribIndex < numAttributes ; attribIndex ++ ) { AttributeInfo thisAttrib = ( AttributeInfo ) this . properties . elementAt ( attribIndex ) ; Object thisAttribValue = thisAttrib . getValue ( ) ; Object otherAttribValue = otherSoapObject . getProperty ( thisAttrib . getName ( ) ) ; if ( ! thisAttribValue . equals ( otherAttribValue ) ) { return false ; } } } catch ( Exception e ) { return false ; } return true ; } public String getName ( ) { return name ; } public String getNamespace ( ) { return namespace ; } public Object getProperty ( int index ) { return ( ( PropertyInfo ) properties . elementAt ( index ) ) . getValue ( ) ; } public Object getProperty ( String name ) { for ( int i = 0 ; i < properties . size ( ) ; i ++ ) { if ( name . equals ( ( ( PropertyInfo ) properties . elementAt ( i ) ) . getName ( ) ) ) return getProperty ( i ) ; } throw new RuntimeException ( "illegal property: " + name ) ; } public int getPropertyCount ( ) { return properties . size ( ) ; } public void getAttributeInfo ( int index , AttributeInfo attributeInfo ) { AttributeInfo p = ( AttributeInfo ) attributes . elementAt ( index ) ; attributeInfo . name = p . name ; attributeInfo . namespace = p . namespace ; attributeInfo . flags = p . flags ; attributeInfo . type = p . type ; attributeInfo . elementType = p . elementType ; attributeInfo . value = p . getValue ( ) ; } public Object getAttribute ( int index ) { return ( ( AttributeInfo ) attributes . elementAt ( index ) ) . getValue ( ) ; } public Object getAttribute ( String name ) { for ( int i = 0 ; i < attributes . size ( ) ; i ++ ) { if ( name . equals ( ( ( AttributeInfo ) attributes . elementAt ( i ) ) . getName ( ) ) ) return getAttribute ( i ) ; } throw new RuntimeException ( "illegal property: " + name ) ; } public int getAttributeCount ( ) { return attributes . size ( ) ; } public void getPropertyInfo ( int index , Hashtable properties , PropertyInfo propertyInfo ) { getPropertyInfo ( index , propertyInfo ) ; } public void getPropertyInfo ( int index , PropertyInfo propertyInfo ) { PropertyInfo p = ( PropertyInfo ) properties . elementAt ( index ) ; propertyInfo . name = p . name ; propertyInfo . namespace = p . namespace ; propertyInfo . flags = p . flags ; propertyInfo . type = p . type ; propertyInfo . elementType = p . elementType ; } public SoapObject newInstance ( ) { SoapObject o = new SoapObject ( namespace , name ) ; for ( int propIndex = 0 ; propIndex < properties . size ( ) ; propIndex ++ ) { PropertyInfo propertyInfo = ( PropertyInfo ) properties . elementAt ( propIndex ) ; o . addProperty ( propertyInfo ) ; } for ( int attribIndex = 0 ; attribIndex < attributes . size ( ) ; attribIndex ++ ) { AttributeInfo attributeInfo = ( AttributeInfo ) attributes . elementAt ( attribIndex ) ; o . addAttribute ( attributeInfo ) ; } return o ; } public void setProperty ( int index , Object value ) { ( ( PropertyInfo ) properties . elementAt ( index ) ) . setValue ( value ) ; } public SoapObject addProperty ( String name , Object value ) { PropertyInfo propertyInfo = new PropertyInfo ( ) ; propertyInfo . name = name ; propertyInfo . type = value == null ? PropertyInfo . OBJECT_CLASS : value . getClass ( ) ; propertyInfo . value = value ; return addProperty ( propertyInfo ) ; } public SoapObject addProperty ( PropertyInfo propertyInfo , Object value ) { propertyInfo . setValue ( value ) ; addProperty ( propertyInfo ) ; return this ; } public SoapObject addProperty ( PropertyInfo propertyInfo ) { properties . addElement ( propertyInfo ) ; return this ; } public SoapObject addAttribute ( String name , Object value ) { AttributeInfo attributeInfo = new AttributeInfo ( ) ; attributeInfo . name = name ; attributeInfo . type = value == null ? PropertyInfo . OBJECT_CLASS : value . getClass ( ) ; attributeInfo . value = value ; return addAttribute ( attributeInfo ) ; } public SoapObject addAttribute ( AttributeInfo attributeInfo ) { attributes . addElement ( attributeInfo ) ; return this ; } public String toString ( ) { StringBuffer buf = new StringBuffer ( "" + name + "{" ) ; for ( int i = 0 ; i < getPropertyCount ( ) ; i ++ ) { buf . append ( "" + ( ( PropertyInfo ) properties . elementAt ( i ) ) . getName ( ) + "=" + getProperty ( i ) + "; " ) ; } buf . append ( "}" ) ; return buf . toString ( ) ; } } 
>>>>>>> ab1fba6c6e93a4331abe98d3c4c0cdc860e899a6
