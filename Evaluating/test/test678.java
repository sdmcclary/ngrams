public class MarshalHashtable implements Marshal { public static final String NAMESPACE = "http://xml.apache.org/xml-soap" ; public static final String NAME = "Map" ; public static final Class HASHTABLE_CLASS = new Hashtable ( ) . getClass ( ) ; SoapSerializationEnvelope envelope ; public Object readInstance ( XmlPullParser parser , String namespace , String name , PropertyInfo expected ) throws IOException , XmlPullParserException { Hashtable instance = new Hashtable ( ) ; String elementName = parser . getName ( ) ; while ( parser . nextTag ( ) != XmlPullParser . END_TAG ) { SoapObject item = new ItemSoapObject ( instance ) ; parser . require ( XmlPullParser . START_TAG , null , "item" ) ; parser . nextTag ( ) ; Object key = envelope . read ( parser , item , 0 , null , null , PropertyInfo . OBJECT_TYPE ) ; parser . nextTag ( ) ; if ( key != null ) { item . setProperty ( 0 , key ) ; } Object value = envelope . read ( parser , item , 1 , null , null , PropertyInfo . OBJECT_TYPE ) ; parser . nextTag ( ) ; if ( value != null ) { item . setProperty ( 1 , value ) ; } parser . require ( XmlPullParser . END_TAG , null , "item" ) ; } parser . require ( XmlPullParser . END_TAG , null , elementName ) ; return instance ; } public void writeInstance ( XmlSerializer writer , Object instance ) throws IOException { Hashtable h = ( Hashtable ) instance ; SoapObject item = new SoapObject ( null , null ) ; item . addProperty ( "key" , null ) ; item . addProperty ( "value" , null ) ; for ( Enumeration keys = h . keys ( ) ; keys . hasMoreElements ( ) ; ) { writer . startTag ( "" , "item" ) ; Object key = keys . nextElement ( ) ; item . setProperty ( 0 , key ) ; item . setProperty ( 1 , h . get ( key ) ) ; envelope . writeObjectBody ( writer , item ) ; writer . endTag ( "" , "item" ) ; } } class ItemSoapObject extends SoapObject { Hashtable h ; int resolvedIndex = - 1 ; ItemSoapObject ( Hashtable h ) { super ( null , null ) ; this . h = h ; addProperty ( "key" , null ) ; addProperty ( "value" , null ) ; } public void setProperty ( int index , Object value ) { if ( resolvedIndex == - 1 ) { super . setProperty ( index , value ) ; resolvedIndex = index ; } else { Object resolved = resolvedIndex == 0 ? getProperty ( 0 ) : getProperty ( 1 ) ; if ( index == 0 ) h . put ( value , resolved ) ; else h . put ( resolved , value ) ; } } } public void register ( SoapSerializationEnvelope cm ) { envelope = cm ; cm . addMapping ( MarshalHashtable . NAMESPACE , MarshalHashtable . NAME , HASHTABLE_CLASS , this ) ; } } 