<<<<<<< HEAD
public class MarioComponent extends JComponent implements Runnable , FocusListener , Environment { private static final long serialVersionUID = 790878775993203817L ; public static final int TICKS_PER_SECOND = 24 ; private boolean running = false ; private int width , height ; private GraphicsConfiguration graphicsConfiguration ; private Scene scene ; private boolean focused = false ; int frame ; int delay ; Thread animator ; private int ZLevelEnemies = 1 ; private int ZLevelMap = 1 ; public void setGameViewer ( GameViewer gameViewer ) { this . gameViewer = gameViewer ; } private GameViewer gameViewer = null ; private Agent agent = null ; private CheaterKeyboardAgent cheatAgent = null ; private KeyAdapter prevHumanKeyBoardAgent ; private Mario mario = null ; private LevelScene levelScene = null ; public MarioComponent ( int width , int height ) { adjustFPS ( ) ; this . setFocusable ( true ) ; this . setEnabled ( true ) ; this . width = width ; this . height = height ; Dimension size = new Dimension ( width , height ) ; setPreferredSize ( size ) ; setMinimumSize ( size ) ; setMaximumSize ( size ) ; setFocusable ( true ) ; if ( this . cheatAgent == null ) { this . cheatAgent = new CheaterKeyboardAgent ( ) ; this . addKeyListener ( cheatAgent ) ; } GlobalOptions . registerMarioComponent ( this ) ; } public void adjustFPS ( ) { int fps = GlobalOptions . FPS ; delay = ( fps > 0 ) ? ( fps >= GlobalOptions . InfiniteFPS ) ? 0 : ( 1000 / fps ) : 100 ; } public void paint ( Graphics g ) { } public void update ( Graphics g ) { } public void init ( ) { graphicsConfiguration = getGraphicsConfiguration ( ) ; Art . init ( graphicsConfiguration ) ; } public void start ( ) { if ( ! running ) { running = true ; animator = new Thread ( this , "Game Thread" ) ; animator . start ( ) ; } } public void stop ( ) { running = false ; } public void run ( ) { } public VolatileImage image = null ; public EvaluationInfo run1 ( int currentAttempt , int totalNumberOfAttempts ) { running = true ; adjustFPS ( ) ; EvaluationInfo evaluationInfo = new EvaluationInfo ( ) ; image = null ; Graphics g = null ; Graphics og = null ; image = createVolatileImage ( 320 , 240 ) ; g = getGraphics ( ) ; og = image . getGraphics ( ) ; if ( ! GlobalOptions . VisualizationOn ) { String msgClick = "Vizualization is not available" ; drawString ( og , msgClick , 160 - msgClick . length ( ) * 4 , 110 , 1 ) ; drawString ( og , msgClick , 160 - msgClick . length ( ) * 4 , 110 , 7 ) ; } addFocusListener ( this ) ; long tm = System . currentTimeMillis ( ) ; long tick = tm ; int marioStatus = Mario . STATUS_RUNNING ; mario = ( ( LevelScene ) scene ) . mario ; int totalActionsPerfomed = 0 ; Mario . resetCoins ( ) ; while ( running ) { tm = System . currentTimeMillis ( ) ; scene . tick ( ) ; if ( gameViewer != null && gameViewer . getContinuousUpdatesState ( ) ) gameViewer . tick ( ) ; float alpha = 0 ; if ( GlobalOptions . VisualizationOn ) { og . fillRect ( 0 , 0 , 320 , 240 ) ; scene . render ( og , alpha ) ; } if ( agent instanceof ServerAgent && ! ( ( ServerAgent ) agent ) . isAvailable ( ) ) { System . err . println ( "Agent became unavailable. Simulation Stopped" ) ; running = false ; break ; } boolean [ ] action = agent . getAction ( this ) ; if ( action != null ) { for ( int i = 0 ; i < Environment . numberOfButtons ; ++ i ) if ( action [ i ] ) { ++ totalActionsPerfomed ; break ; } } else { System . err . println ( "Null Action received. Skipping simulation..." ) ; stop ( ) ; } ( ( LevelScene ) scene ) . mario . keys = action ; ( ( LevelScene ) scene ) . mario . cheatKeys = cheatAgent . getAction ( null ) ; if ( GlobalOptions . VisualizationOn ) { if ( GlobalOptions . drawText ) { String msg = "Attempt: " + currentAttempt + " of " + ( ( totalNumberOfAttempts == - 1 ) ? "\\infty" : totalNumberOfAttempts ) ; drawString ( og , msg , 7 , 31 , 0 ) ; drawString ( og , msg , 6 , 30 , 1 ) ; msg = agent . getName ( ) ; drawString ( og , msg , 7 , 41 , 0 ) ; drawString ( og , msg , 6 , 40 , 5 ) ; msg = "Selected Actions: " ; drawString ( og , msg , 7 , 51 , 0 ) ; drawString ( og , msg , 6 , 50 , 6 ) ; msg = "" ; if ( action != null ) { for ( int i = 0 ; i < Environment . numberOfButtons ; ++ i ) msg += ( action [ i ] ) ? scene . keysStr [ i ] : "      " ; } else msg = "NULL" ; drawString ( og , msg , 6 , 70 , 1 ) ; if ( ! this . hasFocus ( ) && tick / 4 % 2 == 0 ) { String msgClick = "CLICK TO PLAY" ; drawString ( og , msgClick , 160 - msgClick . length ( ) * 4 , 110 , 1 ) ; drawString ( og , msgClick , 160 - msgClick . length ( ) * 4 , 110 , 7 ) ; } og . setColor ( Color . DARK_GRAY ) ; drawString ( og , "FPS: " + ( ( GlobalOptions . FPS > 99 ) ? "\\infty" : GlobalOptions . FPS . toString ( ) ) , 5 , 22 , 0 ) ; drawString ( og , "FPS: " + ( ( GlobalOptions . FPS > 99 ) ? "\\infty" : GlobalOptions . FPS . toString ( ) ) , 4 , 21 , 7 ) ; } if ( width != 320 || height != 240 ) { g . drawImage ( image , 0 , 0 , 640 * 2 , 480 * 2 , null ) ; } else { g . drawImage ( image , 0 , 0 , null ) ; } } else { marioStatus = ( ( LevelScene ) scene ) . mario . getStatus ( ) ; if ( marioStatus != Mario . STATUS_RUNNING ) stop ( ) ; } if ( delay > 0 ) try { tm += delay ; Thread . sleep ( Math . max ( 0 , tm - System . currentTimeMillis ( ) ) ) ; } catch ( InterruptedException e ) { break ; } frame ++ ; } evaluationInfo . agentType = agent . getClass ( ) . getSimpleName ( ) ; evaluationInfo . agentName = agent . getName ( ) ; evaluationInfo . marioStatus = mario . getStatus ( ) ; evaluationInfo . livesLeft = mario . lives ; evaluationInfo . lengthOfLevelPassedPhys = mario . x ; evaluationInfo . lengthOfLevelPassedCells = mario . mapX ; evaluationInfo . totalLengthOfLevelCells = levelScene . level . getWidthCells ( ) ; evaluationInfo . totalLengthOfLevelPhys = levelScene . level . getWidthPhys ( ) ; evaluationInfo . timeSpentOnLevel = levelScene . getStartTime ( ) ; evaluationInfo . timeLeft = levelScene . getTimeLeft ( ) ; evaluationInfo . totalTimeGiven = levelScene . getTotalTime ( ) ; evaluationInfo . numberOfGainedCoins = Mario . coins ; evaluationInfo . totalActionsPerfomed = totalActionsPerfomed ; evaluationInfo . totalFramesPerfomed = frame ; evaluationInfo . marioMode = mario . getMode ( ) ; if ( agent instanceof ServerAgent && mario . keys != null ) ( ( ServerAgent ) agent ) . integrateEvaluationInfo ( evaluationInfo ) ; return evaluationInfo ; } private void drawString ( Graphics g , String text , int x , int y , int c ) { char [ ] ch = text . toCharArray ( ) ; for ( int i = 0 ; i < ch . length ; i ++ ) { g . drawImage ( Art . font [ ch [ i ] - 32 ] [ c ] , x + i * 8 , y , null ) ; } } public void startLevel ( long seed , int difficulty , int type , int levelLength , int timeLimit ) { scene = new LevelScene ( graphicsConfiguration , this , seed , difficulty , type , levelLength , timeLimit ) ; levelScene = ( ( LevelScene ) scene ) ; scene . init ( ) ; } public void levelFailed ( ) { Mario . lives -- ; stop ( ) ; } public void focusGained ( FocusEvent arg0 ) { focused = true ; } public void focusLost ( FocusEvent arg0 ) { focused = false ; } public void levelWon ( ) { stop ( ) ; } public void toTitle ( ) { } public List < String > getTextObservation ( boolean Enemies , boolean LevelMap , boolean Complete , int ZLevelMap , int ZLevelEnemies ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . LevelSceneAroundMarioASCII ( Enemies , LevelMap , Complete , ZLevelMap , ZLevelEnemies ) ; else { return new ArrayList < String > ( ) ; } } public String getBitmapEnemiesObservation ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . bitmapEnemiesObservation ( 1 ) ; else { return new String ( ) ; } } public String getBitmapLevelObservation ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . bitmapLevelObservation ( 1 ) ; else { return null ; } } public byte [ ] [ ] getCompleteObservation ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . mergedObservation ( this . ZLevelMap , this . ZLevelEnemies ) ; return null ; } public byte [ ] [ ] getEnemiesObservation ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . enemiesObservation ( this . ZLevelEnemies ) ; return null ; } public byte [ ] [ ] getLevelSceneObservation ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . levelSceneObservation ( this . ZLevelMap ) ; return null ; } public boolean isMarioOnGround ( ) { return mario . isOnGround ( ) ; } public boolean mayMarioJump ( ) { return mario . mayJump ( ) ; } public void setAgent ( Agent agent ) { this . agent = agent ; if ( agent instanceof KeyAdapter ) { if ( prevHumanKeyBoardAgent != null ) this . removeKeyListener ( prevHumanKeyBoardAgent ) ; this . prevHumanKeyBoardAgent = ( KeyAdapter ) agent ; this . addKeyListener ( prevHumanKeyBoardAgent ) ; } } public void setPaused ( boolean paused ) { levelScene . paused = paused ; } public void setZLevelEnemies ( int ZLevelEnemies ) { this . ZLevelEnemies = ZLevelEnemies ; } public void setZLevelMap ( int ZLevelMap ) { this . ZLevelMap = ZLevelMap ; } public float [ ] getMarioFloatPos ( ) { return new float [ ] { this . mario . x , this . mario . y } ; } public float [ ] getEnemiesFloatPos ( ) { if ( scene instanceof LevelScene ) return ( ( LevelScene ) scene ) . enemiesFloatPos ( ) ; return null ; } public int getMarioMode ( ) { return mario . getMode ( ) ; } public boolean isMarioCarrying ( ) { return mario . carried != null ; } } 
=======
public class DataUri { public static boolean startsWithData ( String uri ) { return uri != null && uri . length ( ) >= 5 && ( uri . charAt ( 0 ) == 'd' || uri . charAt ( 0 ) == 'D' ) && ( uri . charAt ( 1 ) == 'a' || uri . charAt ( 1 ) == 'A' ) && ( uri . charAt ( 2 ) == 't' || uri . charAt ( 2 ) == 'T' ) && ( uri . charAt ( 3 ) == 'a' || uri . charAt ( 3 ) == 'A' ) && ( uri . charAt ( 4 ) == ':' ) ; } private enum State { AT_START , IN_SUPERTYPE , AT_SUBTYPE_START , IN_SUBTYPE , SEMICOLON_SEEN , WS_BEFORE_SEMICOLON , IN_PARAM_NAME , EQUALS_SEEN , IN_QUOTED_STRING , IN_UNQUOTED_STRING , IN_QUOTED_PAIR , CLOSE_QUOTE_SEEN } private String contentType ; private InputStream inputStream ; protected void init ( IRI uri ) throws IOException , MalformedURLException { if ( ! uri . getScheme ( ) . equals ( "data" ) ) { throw new IllegalArgumentException ( "The input did not start with data:." ) ; } if ( uri . getRawFragment ( ) != null ) { throw new MalformedURLException ( "Fragment is not allowed for data: URIs according to RFC 2397. But if strictly comply with RFC 3986, ignore this error." ) ; } InputStream is = new PercentDecodingReaderInputStream ( new StringReader ( uri . getRawPath ( ) ) ) ; StringBuilder sb = new StringBuilder ( ) ; State state = State . AT_START ; int i = 0 ; for ( ; ; i ++ ) { int b = is . read ( ) ; if ( b == - 1 ) { throw new MalformedURLException ( "Premature end of URI." ) ; } if ( b >= 0x80 ) { throw new MalformedURLException ( "Non-ASCII character in MIME type part of the data URI." ) ; } char c = ( char ) b ; sb . append ( c ) ; switch ( state ) { case AT_START : if ( isTokenChar ( c ) ) { state = State . IN_SUPERTYPE ; continue ; } else if ( c == ';' ) { sb . setLength ( 0 ) ; sb . append ( "text/plain;" ) ; state = State . SEMICOLON_SEEN ; continue ; } else if ( c == ',' ) { contentType = "text/plain;charset=US-ASCII" ; inputStream = is ; return ; } else { throw newDatatypeException ( i , "Expected a token character or a semicolon but saw " , c , " instead." ) ; } case IN_SUPERTYPE : if ( isTokenChar ( c ) ) { continue ; } else if ( c == '/' ) { state = State . AT_SUBTYPE_START ; continue ; } else { throw newDatatypeException ( i , "Expected a token character or “/” but saw " , c , " instead." ) ; } case AT_SUBTYPE_START : if ( isTokenChar ( c ) ) { state = State . IN_SUBTYPE ; continue ; } else { throw newDatatypeException ( i , "Expected a token character but saw " , c , " instead." ) ; } case IN_SUBTYPE : if ( isTokenChar ( c ) ) { continue ; } else if ( c == ';' ) { state = State . SEMICOLON_SEEN ; continue ; } else if ( isWhitespace ( c ) ) { state = State . WS_BEFORE_SEMICOLON ; continue ; } else if ( c == ',' ) { contentType = sb . substring ( 0 , sb . length ( ) - 1 ) ; inputStream = is ; return ; } else { throw newDatatypeException ( i , "Expected a token character, whitespace, a semicolon or a comma but saw " , c , " instead." ) ; } case WS_BEFORE_SEMICOLON : if ( isWhitespace ( c ) ) { continue ; } else if ( c == ';' ) { state = State . SEMICOLON_SEEN ; continue ; } else { throw newDatatypeException ( i , "Expected whitespace or a semicolon but saw " , c , " instead." ) ; } case SEMICOLON_SEEN : if ( isWhitespace ( c ) ) { continue ; } else if ( isTokenChar ( c ) ) { state = State . IN_PARAM_NAME ; continue ; } else { throw newDatatypeException ( i , "Expected whitespace or a token character but saw " , c , " instead." ) ; } case IN_PARAM_NAME : if ( isTokenChar ( c ) ) { continue ; } else if ( c == '=' ) { state = State . EQUALS_SEEN ; continue ; } else if ( c == ',' ) { int baseFirst = sb . length ( ) - 8 ; if ( baseFirst >= 0 && ";base64," . equals ( sb . substring ( baseFirst , sb . length ( ) ) ) ) { contentType = sb . substring ( 0 , baseFirst ) ; inputStream = new Base64InputStream ( is ) ; return ; } } else { throw newDatatypeException ( i , "Expected an equals sign, a comma or a token character but saw " , c , " instead." ) ; } case EQUALS_SEEN : if ( c == '\"' ) { state = State . IN_QUOTED_STRING ; continue ; } else if ( isTokenChar ( c ) ) { state = State . IN_UNQUOTED_STRING ; continue ; } else { throw newDatatypeException ( i , "Expected a double quote or a token character but saw " , c , " instead." ) ; } case IN_QUOTED_STRING : if ( c == '\\' ) { state = State . IN_QUOTED_PAIR ; continue ; } else if ( c == '\"' ) { state = State . CLOSE_QUOTE_SEEN ; continue ; } else if ( isQDTextChar ( c ) ) { continue ; } else { throw newDatatypeException ( i , "Expected a non-control ASCII character but saw " , c , " instead." ) ; } case IN_QUOTED_PAIR : if ( c <= 127 ) { state = State . IN_QUOTED_STRING ; continue ; } else { throw newDatatypeException ( i , "Expected an ASCII character but saw " , c , " instead." ) ; } case CLOSE_QUOTE_SEEN : if ( c == ';' ) { state = State . SEMICOLON_SEEN ; continue ; } else if ( isWhitespace ( c ) ) { state = State . WS_BEFORE_SEMICOLON ; continue ; } else if ( c == ',' ) { contentType = sb . substring ( 0 , sb . length ( ) - 1 ) ; inputStream = is ; return ; } else { throw newDatatypeException ( i , "Expected an ASCII character but saw " , c , " instead." ) ; } case IN_UNQUOTED_STRING : if ( isTokenChar ( c ) ) { continue ; } else if ( c == ';' ) { state = State . SEMICOLON_SEEN ; continue ; } else if ( isWhitespace ( c ) ) { state = State . WS_BEFORE_SEMICOLON ; continue ; } else if ( c == ',' ) { contentType = sb . substring ( 0 , sb . length ( ) - 1 ) ; inputStream = is ; return ; } else { throw newDatatypeException ( i , "Expected a token character, whitespace, a semicolon, or a comma but saw " , c , " instead." ) ; } } } } public DataUri ( String uri ) throws IOException , MalformedURLException { IRIFactory fac = new IRIFactory ( ) ; fac . shouldViolation ( true , false ) ; fac . securityViolation ( true , false ) ; fac . dnsViolation ( true , false ) ; fac . mintingViolation ( false , false ) ; fac . useSpecificationIRI ( true ) ; init ( fac . construct ( uri ) ) ; } public DataUri ( IRI uri ) throws IOException , MalformedURLException { init ( uri ) ; } private IOException newDatatypeException ( int i , String head , char c , String tail ) { return new DataUriException ( i , head , c , tail ) ; } private boolean isQDTextChar ( char c ) { return ( c >= ' ' && c <= 126 ) || ( c == '\n' ) || ( c == '\r' ) || ( c == '\t' ) ; } private boolean isTokenChar ( char c ) { return ( c >= 33 && c <= 126 ) && ! ( c == '(' || c == ')' || c == '<' || c == '>' || c == '@' || c == ',' || c == ';' || c == ':' || c == '\\' || c == '\"' || c == '/' || c == '[' || c == ']' || c == '?' || c == '=' || c == '{' || c == '}' ) ; } private boolean isWhitespace ( char c ) { return c == ' ' || c == '\t' || c == '\n' || c == '\r' ; } public String getContentType ( ) { return contentType ; } public InputStream getInputStream ( ) { return inputStream ; } } 
>>>>>>> ab1fba6c6e93a4331abe98d3c4c0cdc860e899a6
